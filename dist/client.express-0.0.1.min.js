// client.express.js JavaScript Routing, version: 0.0.1
// (c) 2011 Mark Nijhof
//
//  Released under MIT license.
//
ClientExpress={};ClientExpress.createServer=function(){return new ClientExpress.Server};ClientExpress.supported=function(){return typeof window.history.pushState=="function"};
ClientExpress.Server=function(){function a(a,b,c,e){console.log("Register route for: "+c);d.registerRoute(b,c,e);return a}var d,b,c,e=function(){d=new ClientExpress.Router;b=new ClientExpress.EventListener(this);c={}},f=e.prototype;f.version=function(){return"0.0.1"};f.router=function(){return d};f.session=function(){return c};f.get=function(b,c){return a(this,"get",b,c)};f.post=function(b,c){return a(this,"post",b,c)};f.put=function(b,c){return a(this,"put",b,c)};f.del=function(b,c){return a(this,
"del",b,c)};f.listen=function(){b.registerEventHandlers()};f.processRequest=function(a){var b=d.match(a.method,a.path);if(b.resolved()){var c=new ClientExpress.Response(a);b.action(a,c);this.processResponse(c)}else console.log("Delegating to the server!"),a.delegateToServer()};f.processResponse=function(a){console.log("processing: "+a.request().path)};return e}();
ClientExpress.Route=function(a,d,b,c){this.resolved=function(){return!0};this.method=a;this.path=d;this.action=b;this.regexp=function(a,b,c){if(a instanceof RegExp)return a;a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,e,g,h){b.push({name:e,optional:!!h});c=c||"";return""+(h?"":c)+"(?:"+(h?c:"")+(d||"")+(g||"([^/]+?)")+")"+(h||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)");return RegExp("^"+a+"$",c?"":"i")}(d,this.keys=[],c.sensitive)};
ClientExpress.Route.prototype.match=function(a){return this.regexp.exec(a)};ClientExpress.Router=function(){var a,d=function(){a={get:[],post:[],put:[],del:[]}},b=d.prototype;b.match=function(c,b){for(var d=a[c].length,g=0;g<d;++g){var i=a[c][g];if(i.match(b))return i}return{resolved:function(){return!1}}};b.registerRoute=function(b,d,f){a[b].push(new ClientExpress.Route(b,d,f,{sensitive:!1}))};return d}();
ClientExpress.EventListener=function(){var a,d=function(b){a=b};d.prototype.registerEventHandlers=function(){console.log("Register Event Handlers");document.onclick=function(b){b=b||window.event;var c=b.target||b.srcElement;if(c.tagName.toLowerCase()=="a")return b=new ClientExpress.Request({method:"get",fullPath:c.href,title:c.title,session:a.session(),delegateToServer:function(){window.location.pathname=c.href}}),a.processRequest(b),!1};document.onsubmit=function(b){b=b||window.event;var c=b.target||
b.srcElement;if(c.tagName.toLowerCase()=="form")return b=new ClientExpress.Request({method:c.method,fullPath:[c.action,ClientExpress.utils.serializeArray(c)].join("?"),title:c.title,session:a.session(),delegateToServer:function(){c.submit()}}),console.log(b),a.processRequest(b),!1}};return d}();
ClientExpress.Request=function(){return function(a){var d=this;this.session=a.session;this.params={};this.title=a.title;(this.queryString=a.fullPath.split("?")[1])&&ClientExpress.utils.forEach(this.queryString.split("&"),function(a){var c=a.split("=")[0];a=a.split("=")[1];var e;if(e=/^(\w+)\[(\w+)\]/.exec(c)){var f=e[1];c=e[2];e=d.params[f]||{};e[c]=a;d.params[f]=e}else d.params[c]=a});this.method=(this.params._method||a.method).toLowerCase();this.path=a.fullPath.replace(/\?.+$/,"").replace(window.location.protocol+
"//"+window.location.host,"");this.delegateToServer=a.delegateToServer||function(){}}}();ClientExpress.Response=function(){var a,d=function(b){a=b},b=d.prototype;b.request=function(){return a};b.send=function(){};b.render=function(){};b.redirect=function(){};b.contentType=function(){};return d}();
ClientExpress.utils=function(){return{every:Array.prototype.every?function(a,d,b){return a.every(d,b)}:function(a,d,b){if(a===void 0||a===null)throw new TypeError;a=Object(a);var c=a.length>>>0;if(typeof d!=="function")throw new TypeError;for(var e=0;e<c;e++)if(e in a&&!d.call(b,a[e],e,a))return!1;return!0},forEach:Array.prototype.forEach?function(a,d,b){return a.forEach(d,b)}:function(a,d,b){if(a===void 0||a===null)throw new TypeError;a=Object(a);var c=a.length>>>0;if(typeof d!=="function")throw new TypeError;
for(var e=0;e<c;e++)e in a&&d.call(b,a[e],e,a)},filter:Array.prototype.filter?function(a,d,b){return a.filter(d,b)}:function(a,d,b){if(a===void 0||a===null)throw new TypeError;a=Object(a);var c=a.length>>>0;if(typeof d!=="function")throw new TypeError;for(var e=[],f=0;f<c;f++)if(f in a){var g=a[f];d.call(b,g,f,a)&&e.push(g)}return e},map:Array.prototype.map?function(a,d,b){return a.map(d,b)}:function(a,d,b){if(a===void 0||a===null)throw new TypeError;a=Object(a);var c=a.length>>>0;if(typeof d!=="function")throw new TypeError;
for(var e=Array(c),f=0;f<c;f++)f in a&&(e[f]=d.call(b,a[f],f,a));return e},toArray:function(a,d){return Array.prototype.slice.call(a,d||0)},serializeArray:function(a){var d="";a=a.getElementsByTagName("*");for(var b=0;b<a.length;b++){var c=a[b];if(!c.disabled&&c.name&&c.name.length>0)switch(c.tagName.toLowerCase()){case "input":switch(c.type){case "checkbox":case "radio":c.checked&&(d.length>0&&(d+="&"),d+=c.name+"="+encodeURIComponent(c.value));break;case "hidden":case "password":case "text":d.length>
0&&(d+="&"),d+=c.name+"="+encodeURIComponent(c.value)}break;case "select":case "textarea":d.length>0&&(d+="&"),d+=c.name+"="+encodeURIComponent(c.value)}}return d}}}();
