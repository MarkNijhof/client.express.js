// client.express.js JavaScript Routing, version: 0.0.1
// (c) 2011 Mark Nijhof
//
//  Released under MIT license.
//
(function(a){if(a.ClientExpress)throw Error("clientExpress is already defined");a.ClientExpress={VERSION:"0.0.1"}})(typeof window==="undefined"?this:window);ClientExpress.prototype.createServer=function(){return new ClientExpress.Server};ClientExpress.prototype.supported=function(){return typeof window.history.pushState=="function"};var server=ClientExpress.Server.prototype;ClientExpress.Server=function(){};server.init=function(){this._router=new ClientExpress.Routes};server.routes=function(){return this._router};
server.route=function(a,b,c){this._router.registerRoute(a,b,c);return server};server.get=function(a,b){return this.route("get",a,b)};server.post=function(a,b){return this.route("post",a,b)};server.put=function(a,b){return this.route("put",a,b)};server.del=function(a,b){return this.route("del",a,b)};
server.use=function(a,b){if(typeof b!="ClientExpress.Server")return"not a ClientExpress.Server";a[a.length-1]==="/"&&(a=a.substring(0,a.length-1));for(var c=0,e=b.routes().length;c<e;++c)route=b.routes()[c],this.route(route.method,a+route.path,route.action)};
ClientExpress.Route=function(a,b,c){this.method=a;this.path=b;this.action=c;this.regexp=function(a,b,c){if(a instanceof RegExp)return a;a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,e,f,g,d){b.push({name:f,optional:!!d});c=c||"";return""+(d?"":c)+"(?:"+(d?c:"")+(e||"")+(g||"([^/]+?)")+")"+(d||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)");return RegExp("^"+a+"$",c?"":"i")}(b,this.keys=[],options.sensitive)};
ClientExpress.Route.prototype.match=function(a){return this.regexp.exec(a)};ClientExpress.Router=function(){this._routes={get:{},post:{},put:{},del:{}}};ClientExpress.Router.prototype.registerRoute=function(a,b,c){this._routes[a].push(new ClientExpress.Route(a,b,c))};
