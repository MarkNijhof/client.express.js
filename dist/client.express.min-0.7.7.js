// client.express.js JavaScript Routing, version: 0.7.7
// (c) 2011 Mark Nijhof
//
//  Released under MIT license.
//
var ClientExpress={},__dirname="",process={env:{PORT:3E3}};ClientExpress.createServer=function(){return new ClientExpress.Server};ClientExpress.supported=function(){return typeof window.history.pushState==="function"};ClientExpress.logger=function(){return function(){var b=new ClientExpress.Logger;this.eventBroker.addListener("onLog",function(a){a.arguments.shift()=="warning"?b.warning(a.arguments):b.information(a.arguments)})}};
ClientExpress.setTitle=function(b){var a=b&&b.titleArgument;return function(){this.eventBroker.addListener("onRequestProcessed",function(d){var b;b=d.response.title;a&&d.args[a]&&(b=d.args[a]);if(b)document.title=b})}};ClientExpress.googleAnalytics=function(){return function(){this.eventBroker.addListener("onRequestProcessed",function(b){b.isRedirect||_gaq&&_gaq.push(["_trackPageview",b.request.originalUrl])})}};
ClientExpress.setContentElement=function(b){return function(){this.content_element=(document.getElementById?document.getElementById(b):document.all?document.all[b]:document.layers?document.layers[b]:null)||document.childNodes[1];this.content_element==document.childNodes[1]&&this.log("warning","Element '",b,"' could not be located!")}};
ClientExpress.Logger=function(){var b=function(){};b.prototype.error=function(){typeof console!="undefined"&&console.error(arguments[0].join(" "))};b.prototype.information=function(){typeof console!="undefined"&&console.log(arguments[0].join(" "))};b.prototype.warning=function(){typeof console!="undefined"&&console.warn(arguments[0].join(" "))};return b}();
ClientExpress.Server=function(){var b=0,a=function(){this.version="0.7.7";this.id=[(new Date).valueOf(),b++].join("-");this.settings={};this.templateEngines={};this.router=new ClientExpress.Router;this.eventListener=new ClientExpress.EventListener;this.eventBroker=new ClientExpress.EventBroker(this);this.session={};this.content_element=document.childNodes[1];this.setup_functions=[];this.eventBroker.addListener("onProcessRequest",c);this.eventBroker.addListener("onRequestProcessed",f);this.eventBroker.addListener("onBeforeRender",
e);this.eventBroker.addListener("onAfterRender",h);this.eventBroker.addListener("onRender",l);this.eventBroker.addListener("onSend",j);this.eventBroker.addListener("onRedirect",m)};a.prototype.log=function(){this.eventBroker.fire({type:"Log",arguments:ClientExpress.utils.toArray(arguments)})};a.prototype.configure=function(i,a){typeof i=="function"?this.setup_functions.push(i):this.setup_functions.push(function(){server.enabled(i)&&a.call()})};a.prototype.use=function(i,a){var c=this;if(typeof i==
"function")i.call(this);else if(typeof i=="string"){i[i.length-1]==="/"&&(i=i.substring(0,i.length-1));var f=a.router.routes,f=f.get.concat(f.post.concat(f.put.concat(f.del.concat(f.before.concat(f.after)))));ClientExpress.utils.forEach(f,function(a){var f=a.method,b;b=i;var e=a.path;e instanceof RegExp?(e=e.source,b=e.substr(0,1)=="^"?RegExp("^"+b+e.substr(1,e.length)):e.substr(0,2)=="\\/"?RegExp(b+e):RegExp(b+"/"+e)):b=e=="/"?b:e.substr(0,1)!="/"?b+"/"+e:b+e;d(c,f,b,a.action,i)})}};a.prototype.set=
function(a,c){if(c===void 0)if(this.settings.hasOwnProperty(a))return this.settings[a];else{if(this.parent)return this.parent.set(a)}else return this.settings[a]=c,this};a.prototype.enable=function(a){this.settings.hasOwnProperty(a);this.settings[a]=!0};a.prototype.disable=function(a){this.settings.hasOwnProperty(a);this.settings[a]=!1};a.prototype.enabled=function(a){return this.settings.hasOwnProperty(a)&&this.settings[a]};a.prototype.disabled=function(a){return this.settings.hasOwnProperty(a)&&
!this.settings[a]};a.prototype.register=function(a,c){if(c===void 0)if(this.templateEngines.hasOwnProperty(a))return this.templateEngines[a];else{if(this.parent)return this.parent.set(a)}else return this.templateEngines[a]=c,this};a.prototype.get=function(a,c){return d(this,"get",a,c,"")};a.prototype.post=function(a,c){return d(this,"post",a,c,"")};a.prototype.put=function(a,c){return d(this,"put",a,c,"")};a.prototype.del=function(a,c){return d(this,"del",a,c,"")};a.prototype.before=function(a,c){return d(this,
"before",a,c,"")};a.prototype.after=function(a,c){return d(this,"after",a,c,"")};var d=function(a,c,f,b,d){a.router.registerRoute(c,f,b,d);return a};a.prototype.listen=function(){if(ClientExpress.supported()){var a=this;ClientExpress.onDomReady(function(){a.eventBroker.fire({type:"BeforeApplyingConfiguration",server:a});ClientExpress.utils.forEach(a.setup_functions,function(c){c.call(a)});a.eventListener.registerEventHandlers(a);g(new ClientExpress.Request({method:"get",originalUrl:window.location.href,
title:document.title,session:a.session,delegateToServer:function(){window.location=window.location.href}}));a.log("information","Listening");var c=a.router.routes.get.concat(a.router.routes.post.concat(a.router.routes.put.concat(a.router.routes.del))).sortByName("path");ClientExpress.utils.forEach(c,function(c){a.log("information","Route registered:",c.method.toUpperCase().lpad("    "),c.path)})})}else this.log("information","Not supported on this browser")};var g=function(a){window.history.replaceState(JSON.stringify(a),
a.title,a.location())},c=function(a){var c=a.request,f=this.router.match(c.method,c.originalUrl);if(f.resolved()){if(!a.request.isHistoryRequest&&!a.request.isRedirect)a=a.request,window.history.pushState(JSON.stringify(a),a.title,a.location());this.log("information",200,c.method.toUpperCase().lpad("    "),c.originalUrl);c.attachRoute(f);a=new ClientExpress.Response(c,this);f.action(c,a)}else this.log("information",404,c.method.toUpperCase().lpad("    "),c.originalUrl),a.request.delegateToServer()},
f=function(){},e=function(a){var c=this,f=a.request,b=a.response,d=this.router.match("before",f.originalUrl),e=function(){c.eventBroker.fire({type:"Render",request:f,response:b,content_element:a.content_element,template:a.template,args:a.args})};d.resolved()?d.action(f,b,a.args,a.content_element,e):e()},l=function(a){var c=this.settings["view engine"]||"",f=(this.settings.views||"")+a.template;f.lastIndexOf(".")!=-1&&f.lastIndexOf(".")<=4&&(c=f.substr(f.lastIndexOf(".")-1,f.length),f=f.substr(0,f.lastIndexOf(".")-
1));c=c||this.settings["view engine"]||"";c!=""&&(c="."+c,f+=c);a.content_element.innerHTML=this.templateEngines[c].compile(f,a.args);k(a.content_element);this.eventBroker.fire({type:"AfterRender",request:a.request,response:a.response,content_element:a.content_element,template:a.template,args:a.args})},k=function(a){if(a.nodeType==1)if(a.tagName.toLowerCase()=="script")a.src!==""?a.appendChild(function(){var c=document.createElement("script");c.type="text/javascript";c.src=a.src;return c}()):eval(a.text);
else for(var c=a.firstChild;c;)c.nodeType==1&&k(c),c=c.nextSibling},h=function(a){var c=this,f=a.request,b=a.response,d=this.router.match("after",f.originalUrl),e=function(){c.eventBroker.fire({type:"RequestProcessed",request:f,response:b,content_element:a.content_element,template:a.template,args:a.args})};d.resolved()?d.action(f,b,a.args,a.content_element,e):e()},j=function(a){a.content_element.innerHTML=a.content;this.eventBroker.fire({type:"RequestProcessed",request:a.request,response:a.response,
content_element:a.content_element,args:{}})},m=function(a){this.log("information",302,"GET ",a.originalUrl);this.eventBroker.fire({type:"ProcessRequest",request:new ClientExpress.Request({method:"get",originalUrl:a.originalUrl,title:"",isRedirect:!0,session:a.request.session,delegateToServer:function(){window.location.originalUrlname=a.originalUrl}})});this.eventBroker.fire({type:"RequestProcessed",request:a.request,response:a.response,content_element:a.content_element,args:{}})};return a}();
ClientExpress.Route=function(){function b(a,b,c){if(a instanceof RegExp)return a;a=a.concat("/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,d,k,h,j){b.push({name:k,optional:!!j});c=c||"";return""+(j?"":c)+"(?:"+(j?c:"")+(d||"")+(h||"([^/]+?)")+")"+(j||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.+)");return RegExp("^"+a+"$",c?"":"i")}var a=function(a,g,c,f,e){this.resolved=function(){return!0};this.method=a;this.path=g;this.action=c;this.base_path=f;
this.params=[];this.regexp=b(g,this.keys=[],e.sensitive)};a.prototype.match=function(a){return this.regexp.exec(a)};return a}();
ClientExpress.Router=function(){var b=function(){this.routes={get:[],post:[],put:[],del:[],before:[],after:[]}};b.prototype.match=function(a,b){for(var g=this.routes[a].length,c=0;c<g;++c){var f=this.routes[a][c];if(captures=f.match(b)){keys=f.keys;f.params=[];g=1;for(c=captures.length;g<c;++g){var e=keys[g-1],l="string"==typeof captures[g]?decodeURIComponent(captures[g]):captures[g];e?f.params[e.name]=l:f.params.push(l)}return f}}return{resolved:function(){return!1}}};b.prototype.registerRoute=function(a,
b,g,c){this.routes[a].push(new ClientExpress.Route(a,b,g,c,{sensitive:!1}))};return b}();
ClientExpress.EventBroker=function(){var b=function(a){this.server=a;this.eventListeners={}};b.prototype.addListener=function(a,b){if(typeof b!="function")throw Error("Event handler for '"+a+"' needs to be a function");typeof this.eventListeners[a]=="undefined"&&(this.eventListeners[a]=[]);this.eventListeners[a].push(b)};b.prototype.removeListener=function(a,b){if(this.eventListeners[a]instanceof Array){var g=this.eventListeners[a];g.forEach(function(a,f){a===b&&g.splice(f,1)})}};b.prototype.fire=
function(a){var b=this;typeof a=="string"&&(a={type:a});if(!a.target)a.target=b.server;if(!a.type)throw Error("Event object missing 'type' property.");a.type="on"+a.type;b.eventListeners[a.type]instanceof Array&&b.eventListeners[a.type].forEach(function(g){g.call(b.server,a)})};return b}();
ClientExpress.EventListener=function(){var b=function(){};b.prototype.registerEventHandlers=function(c){a(c);d(c);g(c)};var a=function(a){document.onclick=function(f){var f=f||window.event,b=f.target||f.srcElement;if(b.tagName.toLowerCase()=="a")return f=new ClientExpress.Request({method:"get",originalUrl:b.href,title:b.title||"",session:a.session,delegateToServer:function(){~b.href.indexOf("://")?window.location=b.href:window.location.pathname=b.href}}),a.eventBroker.fire({type:"ProcessRequest",
request:f}),!1}},d=function(a){document.onsubmit=function(b){var b=b||window.event,e=b.target||b.srcElement;if(e.tagName.toLowerCase()=="form")return b=new ClientExpress.Request({method:e.method,originalUrl:e.action,body:ClientExpress.utils.serializeArray(e),title:e.title,session:a.session,delegateToServer:function(){e.submit()}}),a.eventBroker.fire({type:"ProcessRequest",request:b}),!1}},g=function(a){window.onpopstate=function(b){if(b.state)try{var e=JSON.parse(b.state);e.__proto__=ClientExpress.Request.prototype;
e.HistoryRequest();a.eventBroker.fire({type:"ProcessRequest",request:e})}catch(d){}}};return b}();
ClientExpress.Request=function(){var b=function(a){this.isHistoryRequest=!1;this.session=a.session;this.title=a.title;this.body={};this.params={};this.query={};this.base_path="";this.isRedirect=a.isRedirect||!1;var b=a.originalUrl.split("?")[1],g=a.body;this.processQueryString(b,this.query);this.processQueryString(g,this.body);this.method=(this.body._method||a.method).toLowerCase();this.originalUrl=a.originalUrl.replace(window.location.protocol+"//"+window.location.host,"");this.routePath=this.originalUrl.replace(/\?.+$/,
"");this.delegateToServer=a.delegateToServer||function(){}};b.prototype.processQueryString=function(a,b){a&&ClientExpress.utils.forEach(a.split("&"),function(a){var c=a.split("=")[0],a=a.split("=")[1],f;(f=/^(\w+)\[(\w+)\]/.exec(c))===!0?(paramParent=f[1],c=f[2],f=b[paramParent]||{},f[c]=a,b[paramParent]=f):b[c]=a})};b.prototype.attachRoute=function(a){this.params=a.params;this.base_path=a.base_path;this.routePath=a.path};b.prototype.location=function(){return this.method==="get"?this.originalUrl:
""};b.prototype.param=function(a){return this.params[a]||this.body[a]||this.query[a]||void 0};b.prototype.HistoryRequest=function(){this.isHistoryRequest=!0};return b}();
ClientExpress.Response=function(){var b=function(a,b){this.request=a;this.server=b;this.output=this.redirect_path="";this.title=a.title};b.prototype.send=function(a){this.server.eventBroker.fire({type:"Send",request:this.request,response:this,content_element:this.server.content_element,content:a})};b.prototype.render=function(a,b){this.server.eventBroker.fire({type:"BeforeRender",request:this.request,response:this,content_element:this.server.content_element,template:a,args:b||{}})};b.prototype.redirect=
function(a){this.server.eventBroker.fire({type:"Redirect",request:this.request,response:this,originalUrl:(a.substr(0,1)=="/"?this.request.base_path:"")+a})};return b}();String.prototype.rpad=function(b){return b.substr(0,b.length-this.length)+this};String.prototype.lpad=function(b){return this+b.substr(0,b.length-this.length)};
ClientExpress.utils=function(){var b=Array.prototype.every?function(a,b,e){return a.every(b,e)}:function(a,b,e){if(a===void 0||a===null)throw new TypeError;var a=Object(a),d=a.length>>>0;if(typeof b!=="function")throw new TypeError;for(var g=0;g<d;g++)if(g in a&&!b.call(e,a[g],g,a))return!1;return!0},a=Array.prototype.forEach?function(a,b,e){return a.forEach(b,e)}:function(a,b,e){if(a===void 0||a===null)throw new TypeError;var a=Object(a),d=a.length>>>0;if(typeof b!=="function")throw new TypeError;
for(var g=0;g<d;g++)g in a&&b.call(e,a[g],g,a)},d=Array.prototype.filter?function(a,b,e){return a.filter(b,e)}:function(a,b,e){if(a===void 0||a===null)throw new TypeError;var a=Object(a),d=a.length>>>0;if(typeof b!=="function")throw new TypeError;for(var g=[],h=0;h<d;h++)if(h in a){var j=a[h];b.call(e,j,h,a)&&g.push(j)}return g},g=Array.prototype.map?function(a,b,e){return a.map(b,e)}:function(a,b,e){if(a===void 0||a===null)throw new TypeError;var a=Object(a),d=a.length>>>0;if(typeof b!=="function")throw new TypeError;
for(var g=Array(d),h=0;h<d;h++)h in a&&(g[h]=b.call(e,a[h],h,a));return g};if(!Array.prototype.sortByName)Array.prototype.sortByName=function(a){if(this===void 0||this===null)throw new TypeError;if(typeof a!=="string")throw new TypeError;return this.sort(function(b,e){var d=(b[a]instanceof RegExp?b[a].source:b[a]).toLowerCase(),g=(e[a]instanceof RegExp?e[a].source:e[a]).toLowerCase();return d<g?-1:d>g?1:0})};return{every:b,forEach:a,filter:d,map:g,toArray:function(a,b){return Array.prototype.slice.call(a,
b||0)},serializeArray:function(a){for(var b="",a=a.getElementsByTagName("*"),e=0;e<a.length;e++){var d=a[e];if(!d.disabled&&d.name&&d.name.length>0)switch(d.tagName.toLowerCase()){case "input":switch(d.type){case "checkbox":case "radio":d.checked&&(b.length>0&&(b+="&"),b+=d.name+"="+encodeURIComponent(d.value));break;case "hidden":case "password":case "text":b.length>0&&(b+="&"),b+=d.name+"="+encodeURIComponent(d.value)}break;case "select":case "textarea":b.length>0&&(b+="&"),b+=d.name+"="+encodeURIComponent(d.value)}}return b},
objectIterator:function(a,b){for(var d in a)callBackValue={isFunction:a[d]instanceof Function,name:d,value:a[d]},b(callBackValue)}}}();
ClientExpress.onDomReady=function(b,a){var d=function(a){if((a=a||window.event)&&a.type&&/DOMContentLoaded|load/.test(a.type))g();else if(document.readyState)if(/loaded|complete/.test(f.readyState))g();else if(document.documentElement.doScroll){try{e||document.documentElement.doScroll("left")}catch(b){return}g()}},g=function(){if(!e){e=!0;for(var a=0,b=k.length;a<b;a++)k[a][0].call(k[a][1]);document.removeEventListener&&document.removeEventListener("DOMContentLoaded",d,!1);clearInterval(c);document.onreadystatechange=
window.onload=c=null}},c,f=window.document,e=!1,l=!1,k=[],a=a||window;if(e)b.call(a);else{if(!l)l=!0,document.addEventListener&&document.addEventListener("DOMContentLoaded",d,!1),c=setInterval(d,5),document.onreadystatechange=window.onload=d;k.push([b,a])}};
function require_override(b){function a(){if(typeof XMLHttpRequest!="undefined")return new XMLHttpRequest;else if(window.ActiveXObject)for(var a=["Microsoft.XmlHttp","MSXML2.XmlHttp","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.5.0"],b=a.length-1;b>=0;b--)try{return httpObj=new ActiveXObject(a[b])}catch(c){}throw Error("XMLHttp (AJAX) not supported");}var d=a(),g=require.resolve(b),d=require.modules[g];if(!d){var c,d=a();d.open("GET",g+".js",!1);d.onreadystatechange=function(){this.readyState==
4&&this.status==200&&(c={},(new Function("exports",this.responseText))(c),require.modules[g+".js"]={exports:c})};d.send();if(c!=null)return c;throw Error('failed to require "'+b+'"');}if(!d.exports)d.exports={},d.call(d.exports,d,d.exports,require.relative(g));return d.exports}require_override.modules={};require_override.resolve=function(b){var a=b+".js",d=b+"/index.js";return require.modules[a]&&a||require.modules[d]&&d||b};require_override.register=function(b,a){require.modules[b]=a};
require_override.relative=function(b){return function(a){if("."!=a[0])return require(a);var d=b.split("/"),a=a.split("/");d.pop();for(var g=0;g<a.length;g++){var c=a[g];".."==c?d.pop():"."!=c&&d.push(c)}return require(d.join("/"))}};if(typeof require!="undefined"){var modules=require.modules;require=require_override;require.modules=modules}else require=require_override;
require.register("express.js",function(b,a){a.version="0.7.7";a.createServer=function(){return ClientExpress.createServer()};a.logger=function(){return ClientExpress.logger()};a.setTitle=function(a){return ClientExpress.setTitle(a)};a.googleAnalytics=function(){return ClientExpress.googleAnalytics()};a.setContentElement=function(a){return ClientExpress.setContentElement(a)};a.methodOverride=function(){return function(){}};a.bodyParser=function(){return function(){}};a.cookieParser=function(){return function(){}};
a.session=function(){return function(){}};a["static"]=function(){return function(){}};a.errorHandler=function(){return function(){}}});require.register("clientexpress.js",function(b,a){a.attach=function(){}});
